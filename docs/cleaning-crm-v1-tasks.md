# 极简保洁 CRM V1 开发任务清单

> 面向本地小型保洁公司的「客户跟进 & 续费提醒」工具，对应 `cleaning-crm-v1.md` 中的 V1 范围。
> 本清单按阶段拆分为可以直接执行的开发任务，方便迭代。

## 项目北极星（Product North Star）

### 一、目标用户画像（Who）

- 小型～中小型家政/保洁公司（含保洁、保姆、月嫂等）
- 会用微信、58、抖音、美团等线上渠道接单
- 管理主要依赖老板记忆、纸笔、Excel、微信聊天记录
- 有 2–50 人团队，有专职或兼职“客服/接单/派单”角色
- 希望做大做规范，但缺少简单好用的管理工具

### 二、产品定位（一句话）

> 面向家政/保洁公司的轻量级 CRM：用手机就能管住客户、不再漏单、不怕客户被员工带走。

备用版本：

> 帮家政老板少丢单、多复购，把客户牢牢掌握在自己手里的小工具。

### 三、核心价值（Why）

- **少漏单**：所有咨询统一记录，今日待跟进一目了然，减少忘记回访、遗漏客户。
- **多成交、多复购**：记录跟进状态和下次跟进时间，自动提醒回访；对老客户定期提醒/活动触达，提高复购率和转介绍。
- **客户不被员工带走**：客户资料集中在系统里，员工只是使用权限，降低“员工离职带走客户”的风险。
- **减少返工与管理混乱**：明确记录服务内容、时间、地址和特殊要求，减少沟通错误和差评投诉。

### 四、MVP 功能范围（V1 重点）

围绕“少漏单、多跟进、防带走”三个点：

- **线索与客户管理**：
  - 快速新增客户（姓名、电话、来源渠道、需求描述）
  - 客户列表按状态管理（新线索、跟进中、已成单、长期客户、已流失）
- **跟进与提醒**：
  - 跟进记录（时间、方式、结果）
  - 设置下次跟进时间，到期自动出现在“今日待跟进列表”
- **订单/服务记录（简版）**：
  - 记录每次服务的时间、地址、服务类型、负责员工
  - 在客户详情页查看该客户的历史服务记录
- **基础统计（简版）**：
  - 本周/本月新增线索数
  - 本周/本月成交数（简单数量指标）
- **账号与权限（简版）**：
  - 老板账号可查看全部客户和员工数据
  - 员工账号仅能查看/编辑分配给自己的客户

> V1 不追求功能全面，只要能证明：漏单明显减少、老板能在系统里看清“哪些客户在跟、谁在跟”，即视为达标。

### 五、收费模型草案（How much）

- **体验/入门方案**：
  - 首月 9.9 或前若干个客户免费，降低决策门槛
- **基础版（主推）**：
  - 当前阶段：约 59～99 元 / 月 / 公司
  - 包含：客户管理、跟进提醒、简单统计、基础权限（支持一定数量员工账号）
  - 未来目标：产品验证价值后，逐步提升到 99～199 元 / 月 区间
- **进阶版（预留未来）**：
  - 约 299+ 元 / 月 或按门店计费
  - 未来可扩展：更多统计报表、多门店、渠道分析、对接短信/企微等
- **年付打折**：
  - 例如基础版标价 199/月，年付 1680（约合 140/月），降低“每月扣款”心理压力。

### 六、阶段性目标

在 3～6 个月内完成 V1，并让 3–5 家真实家政/保洁公司持续使用 2 个月以上，验证：

- 漏单数量下降
- 老板能通过系统看清客户与跟进情况
- 至少有 1–2 家愿意按 99–199 元/月付费

---

## 阶段 0：项目基础与多租户骨架

> 目标：在现有项目中，把“公司/用户/会话/多租户”基础打好，能本地跑起来。

- [ ] **数据模型 & 迁移**
  - [ ] 定义 `companies` 表
    - `id`
    - `name`
    - `created_at` / `updated_at`
  - [ ] 定义 `users` 表
    - `id`
    - `company_id`
    - `name`
    - `phone`（可选）
    - `email`（可选）
    - `password_hash`
    - `is_admin`（布尔，V1 只用管理员）
    - `created_at` / `updated_at`
  - [ ] 数据库迁移脚本（根据当前项目使用的迁移工具编写）

- [ ] **后端基础结构**
  - [ ] 初始化/检查数据库连接配置（Dev 环境）
  - [ ] 提供基础健康检查接口 `/health`（便于部署环境验证）
  - [ ] 统一错误响应格式（例如 `{ code, message }`）

- [ ] **认证 & 会话（简化版）**
  - [ ] 定义登录请求/响应 DTO
    - 请求：账号（手机号/邮箱或用户名）+ 密码
    - 响应：会话 Token（JWT 或服务端 Session Id）
  - [ ] 登录接口 `/api/auth/login`
    - 验证用户存在、密码正确
    - 生成会话 Token 并返回
  - [ ] 退出登录接口 `/api/auth/logout`（若使用服务端 Session 则清除）
  - [ ] 中间件：根据请求头/Cookie 提取当前登录用户 & `company_id`

- [ ] **多租户隔离**
  - [ ] 在后端数据访问层统一要求 `company_id` 条件
  - [ ] 在创建任何与业务相关的记录（客户、服务记录、任务）时，自动填充当前用户的 `company_id`

---

## 阶段 1：客户管理（客户列表 + 客户详情）

> 目标：实现「客户录入与查看」能力，为后续服务记录和提醒打基础。

### 1.1 数据模型

- [ ] **`customers` 表**
  - `id`
  - `company_id`
  - `name`
  - `phone`
  - `community` / `address`
  - `service_type`（枚举：一次性 / 包月 / 深度保洁 ...）
  - `service_frequency`（如“每周一次”、“每两周一次”，可用字符串）
  - `last_service_date`（日期，可为空）
  - `next_suggested_service_date`（日期，可为空）
  - `status`（枚举：新客户 / 正在跟进 / 已成单 / 长期客户 / 已流失）
  - `remark`（文本，可选）
  - `created_at` / `updated_at`

### 1.2 后端接口

- [ ] `GET /api/customers`
  - 支持分页（简单 limit/offset）
  - 支持按状态筛选
  - 支持按小区/姓名模糊搜索

- [ ] `POST /api/customers`
  - 创建新客户
  - 自动填充 `company_id`

- [ ] `GET /api/customers/{id}`
  - 返回客户详细信息 + 可选汇总字段（如最近服务信息）

- [ ] `PUT /api/customers/{id}`
  - 更新客户信息（含状态、备注等）

- [ ] `DELETE /api/customers/{id}`（V1 可选）
  - 软删除或逻辑删除（可选，优先级低）

### 1.3 前端页面

- [ ] **客户列表页**
  - [ ] 显示字段：姓名、手机号、小区、服务类型、最近服务日期、下次建议服务日期、状态
  - [ ] 筛选：按状态
  - [ ] 搜索：姓名/小区模糊
  - [ ] 操作：点击行进入详情、新增按钮

- [ ] **客户详情页**
  - [ ] 展示客户全部信息
  - [ ] 可以编辑基本信息（姓名、电话、地址、备注等）
  - [ ] 集成后续的“历史服务记录列表”展示区域（先留占位）

---

## 阶段 2：保洁服务单 & 回访记录

> 目标：记录每一次保洁服务，为回访和续费提醒提供数据基础。

### 2.1 数据模型（保洁服务单）

- [ ] **`service_records` 表**
  - `id`
  - `company_id`
  - `customer_id`
  - `service_date`
  - `service_type`（枚举，与客户类似）
  - `note`（服务备注）
  - `need_follow_up`（布尔）
  - `follow_up_date`（若需要回访，则为回访日期）
  - `follow_up_status`（未回访 / 已回访）
  - `follow_up_result`（枚举：满意 / 一般 / 不满意，可为空）
  - `follow_up_note`
  - `created_at` / `updated_at`

### 2.2 后端接口

- [ ] `GET /api/customers/{id}/service-records`
  - 获取某客户的所有服务记录（按时间倒序）

- [ ] `POST /api/customers/{id}/service-records`
  - 为客户新增服务记录

- [ ] `PUT /api/service-records/{id}`
  - 更新记录（主要用于填写回访结果）

### 2.3 前端页面集成

- [ ] 在客户详情页中：
  - [ ] 展示该客户的服务记录列表（日期、类型、备注、回访状态）
  - [ ] 提供“新增服务记录”表单（弹窗/内嵌均可）
  - [ ] 对已设置回访的记录，提供“填写回访结果”的入口

---

## 阶段 3：待联系客户列表（续约 & 回访）

> 目标：每天让老板看到“今天/本周要联系谁”，不再靠记忆。

### 3.1 数据模型

> V1 可以不单独建 `tasks` 表，改为 **通过规则从 `customers` 和 `service_records` 动态计算待办项**。
>
> 如果你更偏向显式任务表，也可以：
> - 定时任务生成 `tasks`，在这里先不强制。

临时策略（推荐）：

- **续费提醒**：
  - 条件：
    - 客户 `service_type` 为包月/周期性
    - `next_suggested_service_date` 在 [今天, 今天 + N 天]（比如 7 天）之间
- **回访提醒**：
  - 条件：
    - `service_records` 中 `need_follow_up = true`
    - `follow_up_status = 未回访`
    - `follow_up_date` 在 [今天, 今天 + N 天] 范围内

### 3.2 后端接口

- [ ] `GET /api/todos`
  - 查询参数：
    - `scope=today|week|all`（默认 today）
  - 返回结构示例：
    - `type`：`renew` | `follow_up`
    - `customer`：基本信息（姓名、手机号、小区）
    - `related_date`：下次建议服务日期 / 回访日期
    - `source_id`：关联的 customer_id 或 service_record_id，便于前端跳转

- [ ] （可选）`POST /api/todos/complete`
  - 如果你选择显式任务表，需要有“标记完成”的接口
  - 若 V1 只使用动态计算，不落库任务完成状态，则可以通过：
    - 在客户/服务记录上更新状态（例如：标记已续费 / 已回访）来隐式完成

### 3.3 前端页面

- [ ] **待联系客户列表页**
  - [ ] 视图切换：今日 / 本周 / 全部未处理
  - [ ] 列表项：客户姓名 + 手机号 + 小区 + 类型（续费/回访）+ 相关日期
  - [ ] 操作按钮：
    - [ ] “查看客户” → 跳转到客户详情
    - [ ] （可选）“标记为已处理” → 前端调用接口更新对应记录状态

---

## 阶段 4：简单统计页

> 目标：让老板对当月业务有大致感觉，仅需几个关键数字。

### 4.1 统计口径

- 本月服务的客户数量：
  - 基于 `service_records`，按当月 `service_date` 去重 `customer_id`
- 本月新增客户数量：
  - 当月 `customers.created_at` 数量
- 本月潜在流失客户数量：
  - 定义规则：
    - 最近一次服务日期早于 N 天前（如 60 天），且客户状态 != 已流失
- 本月已回访客户数量：
  - 当月内 `service_records.follow_up_status = 已回访` 的记录数

### 4.2 后端接口

- [ ] `GET /api/stats/overview?month=YYYY-MM`
  - 返回上述几个统计数字

### 4.3 前端页面

- [ ] 简单数字卡片展示：
  - 本月服务客户数
  - 本月新增客户数
  - 潜在流失客户数
  - 已回访客户数

---

## 阶段 5：基础部署与环境

> 目标：支持本地开发 + 内网穿透测试，后续方便迁移到云服务器。

- [ ] **配置管理**
  - [ ] 使用 `.env` 或类似机制管理数据库连接、端口等
  - [ ] 区分开发环境和未来生产环境配置

- [ ] **本地运行脚本/说明**
  - [ ] 在 `README` 或单独文档中写明：
    - 如何启动后端
    - 如何启动前端
    - 如何运行数据库迁移

- [ ] **内网穿透准备（试水阶段）**
  - [ ] 选择一个内网穿透工具（frp/ngrok/cpolar 等）
  - [ ] 在 docs 中记录简单使用步骤（可后续补充）

---

## 阶段 6：后续可选优化（V1 可不做）

> 以下任务不属于硬性 V1 范围，可以按时间/精力择机实现。

- [ ] 客户数据导出为 CSV/Excel
- [ ] 更细致的筛选（按小区、服务类型、日期范围等）
- [ ] 短信/微信模板消息集成（V2+ 再考虑）
- [ ] 员工账号区分（客服/老板）与权限控制

---

## 使用建议

- 可以把每一个 `阶段` 视为 1 个迭代（Sprint），按顺序逐步完成。
- 每个阶段完成后，优先找 1–2 位真实用户试用对应功能，收集反馈再决定下一个阶段的优先级。
